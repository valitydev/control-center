@if (!extension?.hidden) {
    @if (view.isValue$ | async) {
        <span
            [queryParams]="extensionQueryParams$ | async"
            [routerLink]="extension?.link?.[0]"
            (click)="extension?.click?.()"
        >
            <span
                *ngIf="extension?.tooltip; else tagValue"
                [matTooltip]="getTooltip(extension?.tooltip)"
                matTooltipClass="tooltip"
            >
                <ng-container *ngTemplateOutlet="tagValue"></ng-container>
            </span>
            <ng-template #tagValue>
                <v-tag *ngIf="extension?.tag; else simpleValue" [color]="extension?.color">
                    <ng-container *ngTemplateOutlet="simpleValue"></ng-container>
                </v-tag>
            </ng-template>
            <ng-template #simpleValue>
                <span
                    [ngClass]="{
                        link: !!extension?.click || !!extension?.link?.[0],
                        'tooltip-link': !!extension?.tooltip,
                        'mat-body-large': !extension?.tag,
                    }"
                >
                    {{ view.renderValue$ | async }}
                </span>
            </ng-template>
        </span>
    } @else {
        <div style="display: grid; grid-template-columns: 1fr; gap: 16px">
            @let leaves = view.leaves$ | async;
            @let count = leaves?.length;

            @if (count) {
                <div class="grid-container">
                    <div [ngClass]="['grid', 'grid-columns-' + count]">
                        @for (item of view.leaves$ | async; track item; let i = $index) {
                            @let current = item.current$ | async;

                            @if (!(current?.extension$ | async)?.hidden) {
                                <div style="display: grid; grid-template-rows: auto 1fr; gap: 8px">
                                    <v-key
                                        [keys]="item.path$ | async"
                                        class="mat-label-medium mat-secondary-text"
                                    ></v-key>

                                    @if (current) {
                                        <div class="mat-body-large">
                                            @if (current.isEmpty$ | async) {
                                                <mat-icon class="mat-secondary-text" inline
                                                    >hide_source</mat-icon
                                                >
                                            } @else {
                                                <v-thrift-tree-viewer
                                                    [data]="current.data$ | async"
                                                    [extension]="current.extension$ | async"
                                                    [extensions]="extensions"
                                                    [value]="current.value$ | async"
                                                ></v-thrift-tree-viewer>
                                            }
                                        </div>
                                    }
                                </div>
                            }
                        }
                    </div>
                </div>
            }

            @for (item of view?.nodes$ | async; track item; let idx = $index) {
                @let current = item.current$ | async;

                @if (idx > 0 || count) {
                    <mat-divider></mat-divider>
                }
                <div
                    [ngStyle]="{
                        display: 'grid',
                        'grid-template-columns':
                            (current?.isNumberKey$ | async) ? 'auto 1fr' : '1fr',
                        gap: '32px',
                    }"
                >
                    @let keyData = current?.key?.data$ | async;

                    @if (keyData) {
                        <v-thrift-tree-viewer
                            [data]="keyData"
                            [extensions]="extensions"
                            [level]="level + 1"
                            [value]="current?.key?.value$ | async"
                        ></v-thrift-tree-viewer>
                    } @else {
                        <v-key
                            [keys]="item.path$ | async"
                            [ngClass]="{
                                'mat-title-large': level === 0,
                                'mat-title-medium': level === 1,
                                'mat-body-large': level >= 2,
                            }"
                        ></v-key>
                    }

                    @if (current) {
                        <v-thrift-tree-viewer
                            [data]="current.data$ | async"
                            [extensions]="extensions"
                            [level]="level + 1"
                            [value]="current.value$ | async"
                        ></v-thrift-tree-viewer>
                    }
                </div>
            }
        </div>
    }
}
