<ng-container *ngIf="view?.items$ | async as items">
    <div *ngIf="!(view.isValue$ | async); else onlyValue" gdColumns="1fr" gdGap="16px">
        <div
            *ngIf="(view.leaves$ | async)?.length as count"
            [gdColumns]="count === 1 ? '1fr' : count === 2 ? '1fr 1fr' : '1fr 1fr 1fr'"
            gdGap="16px"
        >
            <div
                *ngFor="let item of view.leaves$ | async; let i = index"
                gdGap="8px"
                gdRows="auto 1fr"
            >
                <cc-key [keys]="item.path$ | async" class="mat-caption mat-secondary-text"></cc-key>

                <div *ngIf="item.current$ | async as current" class="mat-body-1">
                    <cc-json-viewer
                        *ngIf="!(current.isEmpty$ | async); else empty"
                        [data]="current.data$ | async"
                        [extension]="current.extension$ | async"
                        [extensions]="extensions"
                        [value]="current.value$ | async"
                    ></cc-json-viewer>
                    <ng-template #empty>
                        <mat-icon class="mat-secondary-text" inline>hide_source</mat-icon>
                    </ng-template>
                </div>
            </div>
        </div>

        <ng-container *ngFor="let item of view?.nodes$ | async; let idx = index">
            <mat-divider *ngIf="idx > 0 || (view.leaves$ | async)?.length"></mat-divider>
            <div
                [gdColumns]="((item.current$ | async)?.isNumberKey$ | async) ? 'auto 1fr' : '1fr'"
                gdGap="16px"
            >
                <cc-key
                    *ngIf="!((item.current$ | async)?.key.data$ | async); else mapKey"
                    [class]="className"
                    [keys]="item.path$ | async"
                ></cc-key>
                <ng-template #mapKey>
                    <cc-json-viewer
                        *ngIf="(item.current$ | async)?.key as key"
                        [data]="key.data$ | async"
                        [extensions]="extensions"
                        [level]="level + 1"
                        [value]="key.value$ | async"
                    ></cc-json-viewer
                ></ng-template>

                <cc-json-viewer
                    *ngIf="item.current$ | async as current"
                    [data]="current.data$ | async"
                    [extensions]="extensions"
                    [level]="level + 1"
                    [value]="current.value$ | async"
                ></cc-json-viewer>
            </div>
        </ng-container>
    </div>

    <ng-template #onlyValue>
        <span
            [ngClass]="{'link': !!extension?.link?.[0], 'tooltip': !!extension?.tooltip, 'mat-body-1': true}"
            [queryParams]="extensionQueryParams$ | async"
            [routerLink]="extension?.link?.[0]"
        >
            <span
                *ngIf="extension?.tooltip; else simpleValue"
                [matTooltip]="getTooltip(extension.tooltip)"
                matTooltipClass="tooltip"
                >{{ view.renderValue$ | async }}</span
            >
            <ng-template #simpleValue>{{ view.renderValue$ | async }}</ng-template>
        </span>
    </ng-template>
</ng-container>
